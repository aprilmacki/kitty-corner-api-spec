openapi: 3.1.0
info:
  version: 1.0.0
  title: KittyCorner API
  description: This is the KittyCorner API.
servers:
  - url: http://example.com/v1

tags:
  - name: auth
    description: Authorization Endpoints
  - name: posts
    description: Posts Endpoints
  - name: users
    description: Users Endpoints
  - name: comments
    description: Comments Endpoints
  - name: settings
    description: Settings Endpoints

paths:
  /auth/signup:
    post:
      summary: "Sign up for an account"
      tags:
        - auth
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                username:
                  type: string
                password:
                  type: string
                name:
                  type: string
                birthday:
                  type: string
                pronouns:
                  type: string
            example:
              email: "aprilmack@posteo.net"
              username: "aprilmack"
              password: "8bsb3iiV8eew9aV"
              name: "April"
              birthday: "04/1997"
              pronouns: "she/her"
      responses:
        200:
          description: "Successful"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TokenResponse"

  /auth/signin:
    post:
      summary: "Sign in to your account"
      tags:
        - auth
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                username:
                  type: string
                password:
                  type: string
            example:
              username: "aprilmack"
              password: "8bsb3iiV8eew9aV"
      responses:
        200:
          description: "Successful"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TokenResponse"

  /auth/signout:
    post:
      summary: "Sign out"
      tags:
        - auth
      security:
        - accessToken: []
      responses:
        204:
          description: "Successful"

  /auth/refresh:
    post:
      summary: "Refresh tokens"
      tags:
        - auth
      security:
        - refreshToken: []
      responses:
        200:
          description: "Successful"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TokenResponse"

  /posts:
    get:
      summary: "Get posts"
      tags:
        - posts
      security:
        - accessToken: []
      parameters:
        - name: startAge
          in: query
          required: false
          description: The inclusive start age.
          schema:
            type: integer
            format: int64
            minimum: 18
            default: 18
        - name: endAge
          in: query
          required: false
          description: The inclusive end age. Must be greater than or equal to `startAge`. End age is infinite if omitted.
          schema:
            type: integer
            format: int64
            minimum: 18
        - name: radius
          in: query
          required: false
          description: The search radius in kilometers. Radius is infinite if omitted.
          schema:
            type: integer
            format: int64
            minimum: 1
        - name: limit
          in: query
          required: true
          description: The max number of posts to return
          schema:
            type: integer
            format: int64
            minimum: 1
            maximum: 100
        - name: cursor
          in: query
          required: false
          description: | 
            The first `limit` posts are returned sorted by newest first. Start at the post with ID `cursor`.
            Note that post IDs are auto incrementing chronologically. Start at the newest post if omitted.
          schema:
            type: integer
            format: int64
      responses:
        200:
          description: "Successful"
          content:
            application/json:
              schema:
                type: object
                properties:
                  posts:
                    type: array
                    items:
                      $ref: "#/components/schemas/Post"
                  nextCursor:
                    type: integer
                    format: int64
              example:
                posts:
                  - postId: 15
                    username: francis
                    body: "miaaaoo!"
                    distanceKm: 0.2
                    totalThumbsUp: 23
                    totalThumbsDown: 0
                    totalComments: 1
                    createdAtEpochSeconds: 1740752040
                    updatedAtEpochSeconds: 1740752040
                    myReaction:
                      type: "like"
                  - postId: 14
                    username: minathecat
                    body: "meow"
                    distanceKm: 1.4
                    totalThumbsUp: 102
                    totalThumbsDown: 3
                    totalComments: 3
                    createdAtEpochSeconds: 1740773520
                    updatedAtEpochSeconds: 1740773520
                    myReaction:
                      type: "dislike"
                nextCursor: 13

  /posts/{postId}:
    get:
      summary: "Get post"
      tags:
        - posts
      security:
        - accessToken: [ ]
      parameters:
        - name: postId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        200:
          description: "Successful"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Post"
              example:
                postId: 14
                username: minathecat
                body: "meow"
                distanceKm: 1.4
                totalThumbsUp: 102
                totalThumbsDown: 3
                totalComments: 3
                createdAtEpochSeconds: 1740773520
                updatedAtEpochSeconds: 1740773520
                myReaction: null

  /posts/{postId}/comments:
    parameters:
      - name: postId
        in: path
        required: true
        schema:
          type: integer
          format: int64
    get:
      summary: "Get post comments"
      tags:
        - comments
      security:
        - accessToken: [ ]
      responses:
        200:
          description: "Successful"
          content:
            application/json:
              schema:
                type: object
                properties:
                  comments:
                    type: array
                    items:
                      $ref: "#/components/schemas/Comment"
              example:
                comments:
                  - commentId: 1234
                    username: minathecat
                    body: "i for one actually hate my brother, francis"
                    totalLikes: 2
                    totalDislikes: 23
                    createdAtEpochSeconds: 1741301877
                    updatedAtEpochSeconds: 1741301877
                    myReaction:
                      type: "like"
                  - commentId: 1235
                    username: francis
                    body: "hey that's mean!"
                    totalLikes: 32
                    totalDislikes: 1
                    createdAtEpochSeconds: 1741301955
                    updatedAtEpochSeconds: 1741302015
                    myReaction: null
    post:
      summary: "Create a comment"
      tags:
        - comments
      security:
        - accessToken: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                body:
                  type: string
            example:
              body: "meooow!"
      responses:
        200:
          description: "Success"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Comment"
              example:
                commentId: 15
                username: minathecat
                body: "meooow!"
                totalLikes: 12
                totalDislikes: 0
                createdAtEpochSeconds: 1741301877
                updatedAtEpochSeconds: 1741301877
                myReaction: null

  /posts/{postId}/comments/{commentId}:
    parameters:
      - name: postId
        in: path
        required: true
        schema:
          type: integer
          format: int64
      - name: commentId
        in: path
        required: true
        schema:
          type: integer
          format: int64
    delete:
      summary: "Delete a comment"
      tags:
        - comments
      security:
        - accessToken: [ ]
      responses:
        204:
          description: "Successful"
    put:
      summary: "Edit a comment"
      tags:
        - comments
      security:
        - accessToken: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                body:
                  type: string
            example:
              body: "i've edited this existing comment"
      responses:
        200:
          description: "Success"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Comment"
              example:
                commentId: 15
                username: minathecat
                body: "i've edited this existing comment"
                totalLikes: 12
                totalDislikes: 0
                createdAtEpochSeconds: 1741301877
                updatedAtEpochSeconds: 1741301997
                myReaction: null

  /posts/{postId}/comments/{commentId}/my-reaction:
    parameters:
      - name: postId
        in: path
        required: true
        schema:
          type: integer
          format: int64
      - name: commentId
        in: path
        required: true
        schema:
          type: integer
          format: int64
    post:
      summary: "Create a comment reaction"
      tags:
        - comments
      security:
        - accessToken: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                type:
                  type: string
                  enum: [like, dislike]
            example:
              type: like
      responses:
        204:
          description: "Successful"
    get:
      summary: "Get comment reactions"
      tags:
        - comments
      security:
        - accessToken: [ ]
      responses:
        200:
          description: "Successful"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Reaction"
              example:
                type: like
    delete:
      summary: "Delete my comment reaction"
      tags:
        - comments
      security:
        - accessToken: [ ]
      responses:
        204:
          description: "Successful"

  /posts/{postId}/my-reaction:
    parameters:
      - name: postId
        in: path
        required: true
        schema:
          type: integer
          format: int64
    post:
      summary: "Create a post reaction"
      tags:
        - posts
      security:
        - accessToken: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Reaction"
            example:
              type: like
      responses:
        204:
          description: "Successful"

    get:
      summary: "Get my post reaction"
      tags:
        - posts
      security:
        - accessToken: []
      responses:
        200:
          description: "Successful"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Reaction"
              example:
                type: like
    delete:
      summary: "Delete a post reaction"
      tags:
        - posts
      security:
        - accessToken: [ ]
      responses:
        204:
          description: "Successful"

  /users/{username}/profile:
    get:
      summary: "Get user profile"
      tags:
        - users
      security:
        - accessToken: []
      parameters:
        - name: username
          in: path
          schema:
            type: string
      responses:
        200:
          content:
            application/json:
              schema:
                type: object
                properties:
                  username:
                    type: string
                  name:
                    type: string
                  pronouns:
                    type: string
                  age:
                    type: integer
                    format: int64
                    description: The user's age. This is derived from their birthday which is kept private.
                  location:
                    type: string
                    description: The user's city and state/territory. This is derived from their lat/lon which are kept private.
                  joinedAtEpochSeconds:
                    type: integer
                    format: int64
                  totalPosts:
                    type: integer
                    format: int64
              example:
                username: "minathecat"
                name: "Mina"
                pronouns: "she/her"
                location: "Chicago, IL"
                joinedAtEpochSeconds: 1736971200
                totalPosts: 20
    put:
      summary: "Update user profile"
      tags:
        - users
      security:
        - accessToken: []
      parameters:
        - name: username
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                pronouns:
                  type: string
                birthday:
                  type: string
                  description: MM/DD/YYYY
                latitude:
                  type: number
                  format: decimal
                longitude:
                  type: number
                  format: decimal
            example:
              name: Mina
              pronouns: she/they
              location: Chicago, IL
      responses:
        200:
          content:
            application/json:
              schema:
                type: object
                properties:
                  username:
                    type: string
                  name:
                    type: string
                  pronouns:
                    type: string
                  age:
                    type: integer
                  birthday:
                    type: string
                    required: false
                    description: This is only returned for the current user. MM/DD/YYYY
                  location:
                    type: string
                  joinedAtEpochSeconds:
                    type: integer
                    format: int64
                  totalPosts:
                    type: integer
                    format: int64
              example:
                username: "minathecat"
                name: "Mina"
                pronouns: "she/her"
                age: 5
                location: "Chicago, IL"
                joinedAtEpochSeconds: 1736971200
                totalPosts: 20

  /users/{username}/photo:
    parameters:
        - name: username
          in: path
          required: true
          schema:
            type: string
    get:
      summary: "Get user profile photo"
      tags:
        - users
      security:
        - accessToken: []
      responses:
        200:
          description: "Successful"
          content:
            image/png:
              type: string
              format: binary
    post:
      summary: "Update user profile photo"
      tags:
        - users
      security:
        - accessToken: []
      requestBody:
        required: true
        content:
          image/png:
            schema:
              type: string
              format: binary
      responses:
        204:
          description: "Successful"
    delete:
      summary: "Delete user profile photo"
      tags:
        - users
      security:
        - accessToken: []
      responses:
        204:
          description: "Successful"

  /users/{username}/posts:
    get:
      summary: "Get users posts"
      tags:
        - users
      security:
        - accessToken: []
      parameters:
        - name: username
          in: path
          required: true
          schema:
            type: string
        - name: limit
          in: query
          required: true
          description: The max number of posts to return
          schema:
            type: integer
            format: int64
            minimum: 1
            maximum: 100
        - name: cursor
          in: query
          required: false
          description: |
            The first `limit` posts are returned sorted by newest first. Start at the post with ID `cursor`.
            Note that post IDs are auto incrementing chronologically. Start at the newest post if omitted.
          schema:
            type: integer
            format: int64
      responses:
        200:
          description: "Successful"
          content:
            application/json:
              schema:
                type: object
                properties:
                  posts:
                    type: array
                    items:
                      $ref: "#/components/schemas/Post"
                    nextCursor:
                      type: integer
                      format: int64
              example:
                posts:
                  - postId: 15
                    username: minathecat
                    body: "miaaaoo!"
                    distanceKm: 0.2
                    totalThumbsUp: 23
                    totalThumbsDown: 0
                    totalComments: 1
                    createdAtEpochSeconds: 1740752040
                    myReaction:
                      type: "like"
                  - postId: 14
                    username: minathecat
                    body: "meow"
                    distanceKm: 1.4
                    totalThumbsUp: 102
                    totalThumbsDown: 3
                    totalComments: 3
                    createdAtEpochSeconds: 1740773520
                    myReaction:
                      type: "like"
                nextCursor: 13
  /settings:
    get:
      summary: "Get settings"
      tags:
        - settings
      security:
        - accessToken: []
      responses:
        200:
          description: "Successful"
          content:
            application/json:
              schema:
                type: object
                properties:
                  email:
                    type: string
                  password:
                    type: string
              example:
                username: "aprilmack"
                password: "8bsb3iiV8eew9aV"
    put:
      summary: "Update settings"
      tags:
        - settings
      security:
        - accessToken: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                password:
                  type: string
            example:
              username: "aprilmack"
              password: "8bsb3iiV8eew9aV"

      responses:
        200:
          description: "Successful"
          content:
            application/json:
              schema:
                type: object
                properties:
                  email:
                    type: string
                  password:
                    type: string

components:
  securitySchemes:
    accessToken:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: The access token
    refreshToken:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: The refresh token
  schemas:
    TokenResponse:
      type: object
      properties:
        accessToken:
          type: string
          description: |
            A JWT access token. The client should pass this as an authorization bearer header when making
            subsequent API calls.
          contentMediaType: application/jwt
          contentSchema:
            type: array
            minItems: 2
            prefixItems:
              - type: object
                properties:
                  typ:
                    type: string
                    const: JWT
                  alg:
                    type: string
                    const: HS256
              - type: object
                properties:
                  sub:
                    type: string
                    description: The username
                  exp:
                    type: integer
                    format: int64
                    description: The expiration time in epoch seconds
                  iat:
                    type: integer
                    format: int64
                    description: The issue time in epoch seconds
        refreshToken:
          type: string
          description: |
            A JWT refresh token. The client may use this to fetch a new access and refresh token pair when the
            current access token expires. It may be used once, after which it becomes invalid.
    Post:
      type: object
      properties:
        postId:
          type: integer
          format: int64
        username:
          type: string
        body:
          type: string
        distanceKm:
          type: number
          format: decimal
        totalLikes:
          type: integer
          format: int64
          minimum: 0
        totalDislikes:
          type: integer
          format: int64
          minimum: 0
        totalComments:
          type: integer
          format: int64
          minimum: 0
        createdAtEpochSeconds:
          type: integer
          format: int64
        updatedAtEpochSeconds:
          type: integer
          format: int64
        myReaction:
          type: object
          properties:
            type:
              type: string
              enum: [ like, dislike ]
    Comment:
      type: object
      properties:
        commentId:
          type: string
        username:
          type: string
        body:
          type: string
        totalLikes:
          type: integer
          format: int64
          minimum: 0
        totalDislikes:
          type: integer
          format: int64
          minimum: 0
        createdAtEpochSeconds:
          type: integer
          format: int64
        updatedAtEpochSeconds:
          type: integer
          format: int64
        myReaction:
          type: object
          properties:
            type:
              type: string
              enum: [ like, dislike ]
    Reaction:
      type: object
      properties:
        type:
          type: string
          enum: [ like, dislike ]
